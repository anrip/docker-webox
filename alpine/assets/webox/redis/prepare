#!/bin/sh
#

export APP_USER=redis
export APP_GROUP=redis

#####################################################################

app_prepare() {

    if [ ! -x /usr/bin/redis-server ]; then
        apk add redis
    fi

    local DIR

    for DIR in lib log run tmp; do
        [ -d /var/$DIR/redis ] ||
            mkdir -p /var/$DIR/redis
    done

    if [ ! -f /srv/app/etc/redis/conf.d/useful.conf ]; then
        touch /srv/app/etc/redis/conf.d/useful.conf
    fi

    chown -R $APP_USER:$APP_GROUP /var/*/redis

}

#####################################################################

[ "$1" = "prepare" ] && app_prepare
