#!/bin/sh
#

set -xe

webox=/opt/webox

#####################################################################

apt-get update
apt-get install -y busybox-static

busybox --install -s

rm -rf /var/lib/apt/lists/*
rm -rf `find /var -name *.log*`

#####################################################################

cd ~

name=webox-linux-v13.tgz

wget -O ${name} http://get.vmlu.com/webox/${name}?v13.0
tar -xf ${name} && rm -f ${name}

rm -rf ~/webox/etc/nginx/*/sample-*
rm -rf ~/webox/var/www/default/*
rm -rf ~/webox/var/run
rm -rf ~/webox/var/tmp

cp -af ~/webox/* $webox/
rm -rf ~/webox

#####################################################################

rm -rf /usr/local
ln -sf $webox /usr/local

ln -sf /run $webox/var/run
ln -sf /tmp $webox/var/tmp

chmod +x $webox/etc/init.d/*
chmod +x $webox/sbin/run-cron
chmod +x $webox/sbin/sys-init
chmod +x $webox/sbin/wkit

rm -f /deploy
